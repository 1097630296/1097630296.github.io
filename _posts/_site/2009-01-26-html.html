<p>html页面</p>

<p>[html] view plain copy
在CODE上查看代码片派生到我的代码片</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>  
<span class="nt">&lt;html&gt;</span>  
    <span class="nt">&lt;head&gt;</span>  
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">/&gt;</span>  
        <span class="nt">&lt;title&gt;</span>xhr2<span class="nt">&lt;/title&gt;</span>  
    <span class="nt">&lt;/head&gt;</span>  
    <span class="nt">&lt;body&gt;</span>      
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"text-align:center;margin:100px"</span><span class="nt">&gt;</span>        
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">multiple=</span><span class="s">"multiple"</span><span class="nt">&gt;&lt;progress</span> <span class="na">id=</span><span class="s">"uploadprogress"</span> <span class="na">min=</span><span class="s">"0"</span> <span class="na">max=</span><span class="s">"100"</span> <span class="na">value=</span><span class="s">"0"</span><span class="nt">&gt;</span>0<span class="nt">&lt;/progress&gt;</span>  
            <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"xhr2()"</span><span class="nt">&gt;</span>多文件上传<span class="nt">&lt;/button&gt;</span>  
        <span class="nt">&lt;/div&gt;</span>          
        <span class="nt">&lt;script&gt;</span>  
        <span class="kd">function</span> <span class="nx">xhr2</span><span class="p">(){</span>  
            <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span><span class="c1">//第一步  </span>
            <span class="c1">//定义表单变量  </span>
            <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'file'</span><span class="p">).</span><span class="nx">files</span><span class="p">;</span>  
            <span class="c1">//console.log(file.length);  </span>
            <span class="c1">//新建一个FormData对象  </span>
            <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span> <span class="c1">//++++++++++  </span>
            <span class="c1">//追加文件数据  </span>
            <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">file</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>    
                 <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"file["</span><span class="o">+</span><span class="nx">i</span><span class="o">+</span><span class="s2">"]"</span><span class="p">,</span> <span class="nx">file</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span> <span class="c1">//++++++++++  </span>
            <span class="p">}</span>   
            <span class="c1">//formData.append("file", file[0]); //++++++++++  </span>
              
            <span class="c1">//post方式  </span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="s1">'xhr2.php'</span><span class="p">);</span> <span class="c1">//第二步骤  </span>
                        <span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onprogress</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>  
            <span class="err">　　</span><span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>  
            <span class="err">　　　　</span><span class="kd">var</span> <span class="nx">complete</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">event</span><span class="p">.</span><span class="nx">total</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">|</span> <span class="mi">0</span><span class="p">);</span>  
        <span class="err">　　　　　　</span>     <span class="kd">var</span> <span class="nx">progress</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'uploadprogress'</span><span class="p">);</span>  
            <span class="err">　　　　</span><span class="nx">progress</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">progress</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">complete</span><span class="p">;</span>  
            <span class="err">　　</span><span class="p">}</span>  
            <span class="p">};</span>  
            <span class="c1">//发送请求  </span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">);</span>  <span class="c1">//第三步骤  </span>
            <span class="c1">//ajax返回  </span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="c1">//第四步  </span>
        <span class="err">　　　　</span><span class="k">if</span> <span class="p">(</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span> <span class="p">)</span> <span class="p">{</span>  
        <span class="err">　　　　　　</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span> <span class="p">);</span>  
        <span class="err">　　　　</span><span class="p">}</span>  
        <span class="err">　　</span><span class="p">};</span>  
            <span class="c1">//设置超时时间  </span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">;</span>  
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">ontimeout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>  
        <span class="err">　　　　</span><span class="nx">alert</span><span class="p">(</span><span class="s1">'请求超时！'</span><span class="p">);</span>  
        <span class="err">　　</span><span class="p">}</span>   
        <span class="p">}</span>  
        <span class="nt">&lt;/script&gt;</span>  
    <span class="nt">&lt;/body&gt;</span>  
<span class="nt">&lt;/html&gt;</span>  
</code></pre>
</div>

<p>php处理页面</p>

<p>[php] view plain copy
在CODE上查看代码片派生到我的代码片</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;?php  
print_r($_FILES["file"]);  
  
for($i=0;$i&lt;count($_FILES["file"]['name']);$i++){  
$name=$_FILES["file"]["name"][$i];  
move_uploaded_file($_FILES["file"]["tmp_name"][$i],iconv("UTF-8","gb2312",$name));  
}  
  
?&gt;  
</code></pre>
</div>
